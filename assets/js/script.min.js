$(document).ready(function(){"use strict";class t{constructor(){this.submission={get:()=>{let t=!1;const e=$("#queueDate").val(),a=df.eightDigits(new Date(e));return $.ajax({url:`${U}/service/get`,async:!1,dataType:"json",data:{d:a},success:function(e){State.Queue.list=e,t=!0}}),t},add:(t,e)=>{let a=!1;const i=new Date;return $.ajax({url:`${U}/service/add`,dataType:"json",type:"post",async:!1,data:{post_date:df.eightDigits(new Date(i)),pcid:t,oid:Oid,dest:e,tstamp:(new Date).getTime()},success:function(t){a=t}}),a},update:(t,e)=>{let a=!1;return $.ajax({url:`${U}/service/update`,dataType:"json",type:"post",async:!1,data:{id:t,dest:e},success:function(t){a=t}}),a},delete:t=>{let e=!1;return $.ajax({url:`${U}/service/delete`,dataType:"json",type:"post",async:!1,data:{id:t},success:function(t){e=t}}),e},call:t=>{let e=!1;return $.ajax({url:`${U}/service/call`,dataType:"json",type:"post",async:!1,data:{id:t},success:function(t){console.log(t),e=!0}}),e}},this.parsers={qnd:t=>{let e="",a="";const i=[{id:1,label:"KIA",value:"kia",current:0,total:0,bg:"#007bb6",c:"#fff"},{id:2,label:"MTBS",value:"mtbs",current:0,total:0,bg:"#282830",c:"#fff"},{id:3,label:"BP",value:"bp",current:0,total:0,bg:"#e67e22",c:"#fff"},{id:4,label:"Gigi dan mulut",value:"gigidanmulut",current:0,total:0,bg:"#d2d7d3",c:"#000"},{id:5,label:"Persalinan",value:"persalinan",current:0,total:0,bg:"#fffa37",c:"#000"}];for(let a=0;a<t.length;a++){const s=i.findIndex(e=>e.value===t[a].dest);i[s].total++;const n=t[a].called?'<i class="fas fa-check-circle"></i>':"";t[a].called&&i[s].current++,e+=`<div class="col-12 border text-center p-1 mb-1 queueListItem" style="background:${i[s].bg};color:${i[s].c};" data-x="${a}">\n              ${a+1}  - ${t[a].name} - ${t[a].cid} ${n}\n            </div>`}for(let t=0;t<i.length;t++)a+=`<div class="border p-3" style="background:${i[t].bg};color:${i[t].c};width:17%;">\n              ${i[t].label} <br> ${i[t].current}/${i[t].total}</div>`;$("#queueList").html(e),$("#queueDests").html(a)},qTotal:t=>{const e=t.length,a=t.filter(t=>t.called).length;$("#queueTotal").html(`${a}/${e}`)},dL:t=>{return[{v:"kia",l:"KIA"},{v:"mtbs",l:"MTBS"},{v:"bp",l:"BP"},{v:"gigidanmulut",l:"Gigi dan mulut"},{v:"persalinan",l:"Persalinan"}].find(e=>e.v===t).l}},this.formBehaviour={openUpdate:()=>{},openView:()=>{},openDelete:()=>{}},this.validation={}}add(t,e){this.submission.add(t,e)&&(addQueueForm.reset(),this.init())}update(){const{id:t}=State.Queue.toUpdate,e=$("#updateQueueDest").val();this.submission.update(t,e)&&(this.init(),$("#updateQueueModal").modal("hide"))}delete(){const{id:t}=State.Queue.toDelete;this.submission.delete(t)&&($("#deleteQueueModal").modal("hide"),this.init())}call(t){const e=State.Queue.list.find(e=>parseInt(e.s_id)===parseInt(t)),a=State.Queue.list.findIndex(e=>parseInt(e.s_id)===parseInt(t));e.called||this.submission.call(t)&&(this.init(),this.showInfo(a))}init(){this.submission.get()&&this.render()}render(){const t=State.Queue.list;this.parsers.qnd(t),this.parsers.qTotal(t)}showInfo(t){const e=State.Queue.list[t],{address:a,allergic:i,called:s,cid:n,dest:l,diagnose:d,finished:o,history:u,jknid:r,med:c,name:p,oid:m,patient_id:g,pcid:f,phone:h,post_date:v,rmid:b,s_id:y,tstamp:D}=e,I=`<h4>${p} ${s?'<small class="badge bg-success rounded-pill" style="font-size:0.7rem;"><i class="fas fa-check-circle"></i></small>':""}\n          <small>\n          <span class="float-end">\n            <a href="javascript:void(null);" data-id="${y}" class="${s?"text-info  disabled":"text-info call-q-item"}" title="panggil"><i class="fas fa-check"></i></a>\n            <a href="javascript:void(null);" data-id="${y}" class="text-primary edit-q-item" title="ubah"><i class="fas fa-pencil-alt"></i></a>\n            <a href="javascript:void(null);" data-id="${y}" class="text-danger delete-q-item" title="hapus"><i class="fas fa-trash"></i></a>\n          </span>\n          </small>\n        </h4>\n      <ul class="list-group" >\n        <li class="list-group-item"> No antrian: ${t+1}</li>\n        <li class="list-group-item"> Ruang: ${this.parsers.dL(l)}</li>\n        <li class="list-group-item"> NIK: ${n}</li>\n        <li class="list-group-item"> No JKN: ${r}</li>\n        <li class="list-group-item"> No RM: ${b}</li>\n        <li class="list-group-item"> Telepon: ${h}</li>\n        <li class="list-group-item"> Alamat: ${a}</li>\n        <li class="list-group-item"> Riwayat Penyakit: ${u}</li>\n        <li class="list-group-item"> Alergi: ${i}</li>\n        <li class="list-group-item"> Diagnosa: ${d}</li>\n        <li class="list-group-item"> Obat: ${c}</li>\n      </ul>`;$("#queueInfo").html(I)}}const e=new t;e.init();class a{constructor(){this.validation={},this.submission={get:()=>{$.ajax({url:`${U}/patient/get`,dataType:"json",async:!1,success:function(t){State.Patient.list=t}})},add:t=>{let e=!1;return $.ajax({url:`${U}/patient/add`,type:"post",dataType:"json",async:!1,data:t,success:function(t){e=t}}),e},update:()=>{let t=!1;const e={id:State.Patient.toUpdate.id,name:$("#updateName").val(),cid:$("#updateCID").val(),rmid:$("#updateRM").val(),jknid:$("#updateJKN").val(),address:$("#updateAddress").val(),phone:$("#updatePhone").val(),dishis:$("#updateDisHistory").val(),allergic:$("#updateAllergic").val(),diagnose:$("#updateDiag").val(),med:$("#updateMed").val()};return $.ajax({url:`${U}/patient/update`,type:"post",dataType:"json",async:!1,data:e,success:function(e){t=e}}),t},delete:()=>{},getVisitH:t=>{let e=[];return $.ajax({url:`${U}/service/getVisitH`,dataType:"json",async:!1,data:{id:t},success:function(t){e=t}}),e}},this.parsers={visitHistory:t=>{let e="";const a=this.submission.getVisitH(t);if(a.length)for(let t=0;t<a.length;t++){const{called:i,dest:s,finished:n,oid:l,pcid:d,post_date:o,s_id:u,tstamp:r}=a[t];e+=`<li>${df.dmy(o)} - ${this.parsers.dL(s)}</li>`}return e},pInfo:t=>{const{address:e,allergic:a,cid:i,diagnose:s,history:n,jknid:l,med:d,name:o,patient_id:u,phone:r,rmid:c}=t;return`<ul class="list-unstyled">\n            <li class="mb-1"><strong>Nama</strong>: ${o}</li>\n            <li class="mb-1"><strong>NIK</strong>: ${i}</li>\n            <li class="mb-1"><strong>No JKN</strong>: ${l}</li>\n            <li class="mb-1"><strong>No RM</strong>: ${c}</li>\n            <li class="mb-1"><strong>Alamat</strong>: ${e}</li>\n            <li class="mb-1"><strong>Telepon</strong>: ${r}</li>\n            <li class="mb-1"><strong>Riwayat Penyakit</strong>: ${n}</li>\n            <li class="mb-1"><strong>Alergi</strong>: ${a}</li>\n            <li class="mb-1"><strong>Diagnosa</strong>: ${s}</li>\n            <li class="mb-1"><strong>Obat</strong>: ${d}</li>\n          </ul>`},dL:t=>{return[{v:"kia",l:"KIA"},{v:"mtbs",l:"MTBS"},{v:"bp",l:"BP"},{v:"gigidanmulut",l:"Gigi dan mulut"},{v:"persalinan",l:"Persalinan"}].find(e=>e.v===t).l}}}init(){this.submission.get()}add(){const t={name:$("#regName").val(),cid:$("#regCID").val(),rm:$("#regRM").val(),jknid:$("#regJKN").val(),address:$("#regAddress").val(),phone:$("#regPhone").val(),dishis:$("#regDisHistory").val(),allergic:$("#regAllergic").val(),diagnose:$("#regDiag").val(),med:$("#regMed").val(),addToList:$("#addToList").is(":checked")||!1,dest:$("#regAddQueue").val()},{addToList:a,dest:s,cid:n}=t;this.submission.add(t)&&(addPatientForm.reset(),$("#addPatientModal").modal("hide"),i.init(),a&&e.add(n,s))}update(){this.submission.update()&&(updatePatientForm.reset(),$("#updatePatientModal").modal("hide"),i.init())}delete(){}show(t){const e=State.Patient.list.find(e=>parseInt(e.patient_id)===parseInt(t)),a=this.parsers.pInfo(e),i=this.parsers.visitHistory(e.cid);$("#viewPatientModalLabel").html(e.name),$("#viewPatientInfo").html(a),$("#vHist").html(i),$("#viewPatientModal").modal("show")}}const i=new a;i.init(),$("#addPatientForm").on("submit",function(t){t.preventDefault(),i.add()}),$("#addToList").on("change",function(){$(this).is(":checked")?$("#regAddQueueC").fadeIn("slow"):$("#regAddQueueC").fadeOut("fast")}),$("#patientList").on("click",".patientEdit",function(t){const e=$(this).data("id");State.Patient.toUpdate.id=e;const a=State.Patient.list.find(t=>parseInt(t.patient_id)===parseInt(e)),{address:i,allergic:s,cid:n,diagnose:l,history:d,jknid:o,med:u,name:r,patient_id:c,phone:p,rmid:m}=a;$("#updateName").val(r),$("#updateCID").val(n),$("#updateRM").val(m),$("#updateJKN").val(o),$("#updateAddress").val(i),$("#updatePhone").val(p),$("#updateDisHistory").val(d),$("#updateAllergic").val(s),$("#updateDiag").val(l),$("#updateMed").val(u),$("#updatePatientModal").modal("show")}),$("#updatePatientForm").on("submit",function(t){t.preventDefault(),i.update()}),$("#patientList").on("click",".patientDelete",function(){const t=$(this).data("id");State.Patient.toDelete.id=t,$("#deletePatientModal").modal("show")}),$("#deletePatientForm").on("submit",function(t){t.preventDefault();const e=State.Patient.toDelete.id;$.ajax({url:`${U}/patient/delete`,dataType:"json",type:"post",async:!1,data:{id:e},success:function(t){console.log(t),i.init(),$("#deletePatientModal").modal("hide"),deletePatientForm.reset()}})}),$("#patientList").on("click",".patientView",function(){const t=$(this).data("id");i.show(t)}),$("#addQueueForm").on("submit",function(t){t.preventDefault();const a=$("#queueID").val(),i=$("#queueDest").val();a&&i&&e.add(a,i)}),$("#queueList").on("click",".queueListItem",function(){const t=$(this).data("x");e.showInfo(t)}),$("#queueList").on("dblclick",".queueListItem",function(){const t=$(this).data("x");e.call(State.Queue.list[t].s_id)}),$("#queueInfo").on("click",".call-q-item",function(){const t=$(this).data("id");e.call(t)}),$("#queueDate").on("change",function(){e.init()}),$("#queueInfo").on("click",".edit-q-item",function(){const t=$(this).data("id"),e=State.Queue.list.find(e=>parseInt(e.s_id)===parseInt(t));State.Queue.toUpdate.id=e.s_id,console.log(e),$("#updateQueueID").val(e.pcid),$(`#updateQueueDest option[value="${e.dest}"]`).attr("selected","selected"),$("#updateQueueModal").modal("show")}),$("#updateQueueForm").on("submit",function(t){t.preventDefault(),e.update()}),$("#queueInfo").on("click",".delete-q-item",function(){const t=$(this).data("id");State.Queue.toDelete.id=t,$("#deleteQueueModal").modal("show")}),$("#deleteQueueForm").on("submit",function(t){t.preventDefault(),e.delete()}),$("#patientList").DataTable({response:!0,ajax:{url:`${U}/patient/get`,dataSrc:""},language:{search:"Cari",lengthMenu:"Menampilkan _MENU_ entri",info:"Menampilkan _START_-_END_ dari _TOTAL_ entri",emptyTable:"Tidak ada data di tabel",infoEmpty:"Menampilkan 0-0 dari 0 entri",infoFiltered:"(disaring dari _MAX_ total entri)",loadingRecords:"Memuat...",processing:"Memproses...",zeroRecords:"Tidak ada hasil yang sesuai",paginate:{first:"Pertama",last:"Terakhir",next:"Berikutnya",previous:"Sebelumnya"}},columns:[{data:"patient_id"},{data:"name"},{data:"cid"},{data:"rmid"},{data:"jknid"},{data:"address"},{data:"phone"},{data:"patient_id",render:(t,e,a)=>{return`<a href="javascript:void(0);" class="patientEdit text-info" data-id="${t}"><i class="fas fa-pencil-alt"></i></a>\n            <a href="javascript:void(0);" class="patientDelete text-danger" data-id="${t}"><i class="fas fa-trash"></i></a>\n            <a href="javascript:void(0);" class="patientView text-primary" data-id="${t}"><i class="fas fa-eye"></i></a>`}}]})});